{% extends "base.html" %}
{% load static shop_extras %}
{% block title %}{{ event.name|default:"Event" }} — Event Details{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/event_details.css' %}">
  <script defer src="{% static 'js/event_details.js' %}"></script>
{% endblock %}

{% block content %}
<section class="event-hero">
  {% if hero_src %}
    <div class="hero-media">
      <img src="{{ hero_src }}" alt="{{ event.name|default:'Event' }}">
      <div class="hero-vignette"></div>

      <div class="hero-overlay">
        <h1 class="event-title">{{ event.name }}</h1>
        <div class="event-sub">
          {% if event.start %}
            <span class="event-when">{{ event.start|date:"D, M j @ g:ia" }}</span>
          {% else %}
            <span class="event-when tbd">Date TBA</span>
          {% endif %}
          {% if event.venue %}
            <span class="dot">•</span>
            <span class="event-where">
              {{ event.venue.name }}
              {% if event.venue.city %} — {{ event.venue.city }}{% if event.venue.state %}, {{ event.venue.state }}{% endif %}{% endif %}
            </span>
          {% endif %}
        </div>

        <div class="hero-actions">
          {% if any_on_sale %}
            <a class="btn primary" href="{% url 'control:tickets:public_purchase' event.id %}">Get Tickets</a>
          {% else %}
            <span class="btn soldout" aria-disabled="true">Sold Out</span>
          {% endif %}
          {% if ics_url %}
            <a class="btn ghost" href="{{ ics_url }}">Add to Calendar</a>
          {% endif %}
        </div>

        {% if event.start %}
          <div class="countdown" data-countdown="{{ event.start|date:'c' }}">
            <div class="cd-label">Countdown</div>
            <div class="cd-grid">
              <div><span class="cd-val" data-d>0</span><span class="cd-unit">Days</span></div>
              <div><span class="cd-val" data-h>0</span><span class="cd-unit">Hours</span></div>
              <div><span class="cd-val" data-m>0</span><span class="cd-unit">Min</span></div>
              <div><span class="cd-val" data-s>0</span><span class="cd-unit">Sec</span></div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <div class="sticky-buy" data-sticky>
    <div class="sticky-inner">
      <div class="sticky-whenwhere">
        {% if event.start %}
          <strong>{{ event.start|date:"M j" }}</strong>
          <span>• {{ event.name }}</span>
        {% else %}
          <strong>TBD</strong>
          <span>• {{ event.name }}</span>
        {% endif %}
      </div>
      <div class="sticky-actions">
        {% if any_on_sale %}
          <a class="btn primary" href="{% url 'control:tickets:public_purchase' event.id %}">Get Tickets</a>
        {% else %}
          <span class="btn soldout" aria-disabled="true">Sold Out</span>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<section class="event-body container">
  <div class="event-columns">
    <div class="event-main">

      {% if event.about or event.afterparty_info or event.meet_greet_info %}
        <div class="event-info-cards">
          {% if event.about %}
            <article class="info-card">
              <h3>About</h3>
              <p>{{ event.about|linebreaksbr }}</p>
            </article>
          {% endif %}
          {% if event.afterparty_info %}
            <article class="info-card">
              <h3>Afterparty</h3>
              <p>{{ event.afterparty_info|linebreaksbr }}</p>
            </article>
          {% endif %}
          {% if event.meet_greet_info %}
            <article class="info-card">
              <h3>Meet &amp; Greet</h3>
              <p>{{ event.meet_greet_info|linebreaksbr }}</p>
            </article>
          {% endif %}
        </div>
      {% endif %}

    </div>

    <aside class="event-side">
      <div class="panel">
        <h3>Venue</h3>
        {% if event.venue %}
          <div class="venue-name">{{ event.venue.name }}</div>
          {% if event.venue.address %}<div class="muted">{{ event.venue.address }}</div>{% endif %}
          <div class="muted">
            {% if event.venue.city %}{{ event.venue.city }}{% endif %}
            {% if event.venue.state %}, {{ event.venue.state }}{% endif %}
            {% if event.venue.country %}, {{ event.venue.country }}{% endif %}
          </div>
          {% if event.venue.capacity %}
            <div class="muted">Capacity: {{ event.venue.capacity }}</div>
          {% endif %}
          {% if event.start %}
            <a class="btn outline full" target="_blank" rel="noopener"
               href="https://www.google.com/maps/search/?api=1&query={{ event.venue.name|urlencode }}{% if event.venue.city %}+{{ event.venue.city|urlencode }}{% endif %}{% if event.venue.state %}+{{ event.venue.state|urlencode }}{% endif %}">
              Open in Maps
            </a>
          {% endif %}
        {% else %}
          <div class="muted">Venue TBA</div>
        {% endif %}
      </div>

      <div class="panel">
        <h3>Share</h3>
        <div class="share-row">
          <button class="btn small" data-copy-url>Copy Link</button>
          <a class="btn small outline" target="_blank" rel="noopener"
             href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode }}&text={{ event.name|urlencode }}">X/Twitter</a>
        </div>
      </div>
    </aside>
  </div>
</section>
{% endblock %}
