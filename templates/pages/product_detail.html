{% extends "base.html" %}{% load static %}
{% load static %}
{% block title %}{{ p.title }}{% endblock %}
{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
    <script defer src="{% static 'js/product_detail.js' %}"></script>
{% endblock  %}
{% block hero %}
<section class="hero reveal">
  <div class="container">
    <h1 class="hero-title">{{ p.title }}</h1>
    <p class="hero-sub">{{ p.price_display }}</p>
    <div class="hero-actions">
      <a class="btn ghost" href="/shop/">Back to shop</a>
    </div>
  </div>
  <canvas id="orb" aria-hidden="true"></canvas>
</section>
{% endblock %}

{% block content %}
<section class="reveal">
  <div class="pd-grid">
    <div class="pd-gallery">
      <div class="pd-main">
        {% if images %}
          <img id="pdMainImg" src="{{ images.0.url }}" alt="{{ images.0.alt|default:p.title }}">
        {% else %}
          <div class="img-ph">TJA</div>
        {% endif %}
      </div>
      {% if images|length > 1 %}
      <div class="pd-thumbs">
        {% for img in images %}
          <button class="pd-thumb{% if forloop.first %} is-active{% endif %}" data-src="{{ img.url }}" aria-label="Image {{ forloop.counter }}">
            <img src="{{ img.url }}" alt="{{ img.alt|default:p.title }}">
          </button>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <div class="pd-info card">
      <h2 class="pd-title">{{ p.title }}</h2>
      <div class="pd-price">{{ p.price_display }}</div>
      {% if p.inventory > 0 %}
        <div class="p-stock in">In stock</div>
      {% else %}
        <div class="p-stock out">Sold out</div>
      {% endif %}
      {% if p.description %}
        <p class="pd-desc">{{ p.description }}</p>
      {% endif %}

      <div class="p-ctas" style="margin-top:12px">
        <div class="qty">
          <button class="qty-btn" data-dec>âˆ’</button>
          <input class="qty-in" type="number" value="1" min="1">
          <button class="qty-btn" data-inc>+</button>
        </div>
        <button class="btn addCart" {% if p.inventory == 0 %}disabled{% endif %} data-id="{{ p.id }}">Add to Cart</button>
      </div>
    </div>
  </div>
</section>

{% if related %}
<section class="reveal">
  <h3>Related</h3>
  <div class="shop-grid">
    {% for r in related %}
      <article class="product-card">
        <a href="{% url 'product_detail' slug=r.slug %}" class="p-media">
          {% if r.image_url %}<img loading="lazy" src="{{ r.image_url }}" alt="{{ r.title }}">{% else %}<div class="img-ph">TJA</div>{% endif %}
        </a>
        <div class="p-body">
          <h4 class="p-title"><a href="{% url 'product_detail' slug=r.slug %}">{{ r.title }}</a></h4>
          <div class="p-price">{{ r.price_display }}</div>
        </div>
        <div class="p-ctas">
          <a class="btn ghost" href="{% url 'product_detail' slug=r.slug %}">View</a>
        </div>
      </article>
    {% endfor %}
  </div>
</section>
{% endif %}

<div id="toast" class="toast"></div>
{% endblock %}
